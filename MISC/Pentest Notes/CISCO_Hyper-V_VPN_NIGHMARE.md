# Hyper-V Windows 10 Image
Created at 2025-09-10 13:58:58 UTC

> @ 2025-09-10 13:58:58 UTC
>
> in hyper-v windows 10 image 

Looking at the Cisco Secure Client error message, this indicates that VPN establishment capability is disabled for remote users in your Hyper-V Windows 10 VM.

## Solution Steps

1. **Enable Hyper-V Enhanced Session Mode**
   ```powershell
   # Run in elevated PowerShell on Hyper-V host
   Set-VMHost -EnableEnhancedSessionMode $true
   Set-VM -Name "YourVMName" -EnhancedSessionTransportType HvSocket
   ```

2. **Install Hyper-V Integration Services**
   - In the VM, go to Action menu â†’ Insert Integration Services Setup Disk
   - Install the integration services and reboot

3. **Configure Network Adapter Settings**
   ```powershell
   # In VM's PowerShell as Administrator
   Get-NetAdapter | Set-NetAdapterAdvancedProperty -DisplayName "Network Address" -DisplayValue ""
   ```

4. **Alternative: Use External Virtual Switch**
   - In Hyper-V Manager, create an External virtual switch
   - Connect VM to this switch instead of Default Switch
   - This provides direct network access bypassing NAT limitations

5. **Registry Fix (if needed)**
   ```batch
   # Run as Administrator in VM
   reg add "HKLM\SYSTEM\CurrentControlSet\Services\RasMan\Parameters" /v ProhibitIpSec /t REG_DWORD /d 0 /f
   sc config RasMan start= auto
   net start RasMan
   ```

The issue typically occurs because Hyper-V's default NAT configuration blocks certain VPN protocols. Using an external switch or enabling enhanced session mode usually resolves this.

> @ 2025-09-10 14:11:30 UTC
>
> now Enhanced Session Mode does not work ...

## Troubleshooting Enhanced Session Mode in Hyper-V

### Step 1: Verify Host Configuration
```powershell
# Run on Hyper-V host as Administrator
Get-VMHost | Select-Object EnableEnhancedSessionMode
Set-VMHost -EnableEnhancedSessionMode $true
```

### Step 2: Check VM Settings
```powershell
# On Hyper-V host
Get-VM "YourVMName" | Select-Object Name, EnhancedSessionTransportType
Set-VM -Name "YourVMName" -EnhancedSessionTransportType HvSocket
```

### Step 3: Enable Required Services in VM
```powershell
# Run in Windows 10 VM as Administrator
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V-Guest-Integration
```

### Step 4: Registry Configuration in VM
```batch
# Run as Administrator in VM
reg add "HKLM\SOFTWARE\Microsoft\Virtual Machine\Guest" /v OSName /t REG_SZ /d "Windows 10" /f
reg add "HKLM\SOFTWARE\Microsoft\Virtual Machine\Guest" /v OSVersion /t REG_SZ /d "10.0" /f
```

### Step 5: Enable RDP Services in VM
```powershell
# In VM as Administrator
Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
Set-Service -Name TermService -StartupType Automatic
Start-Service -Name TermService
```

### Step 6: Restart Services
```powershell
# In VM
Restart-Service -Name vmicrdv -Force
Restart-Service -Name vmicvss -Force
```

### Step 7: Alternative - Use VMConnect with Local Resources
If Enhanced Session still fails:
1. Connect to VM using basic session
2. Enable RDP manually in VM settings
3. Connect via RDP client with local resource redirection

**Reboot both host and VM after making these changes.**


---

_Generated by [Kagi Assistant](https://kagi.com/assistant)_
